{% extends 'base.html' %}

{% block header %}
  {% block title %}Editar Atividade{% endblock %}
{% endblock %}

{% block conteudo %}
  <div class="flex-fill d-flex align-items-center justify-content-center">
    <div class="text-center border border-black rounded bg-body-tertiary m-1 p-3">
      <h1>Editar atividade</h1>

      {% if erro %}
        <p style="color: red;">{{ erro }}</p>
      {% endif %}

      <form method="POST" enctype="multipart/form-data" 
            action="{{ url_for('auth.editar_tarefa', turma_id=turma_id, disciplina_id=disciplina_id, nome_disciplina=nome_disciplina, atividade_id=atividade.id) }}">
        
        <label for="titulo">Título da atividade</label>
        <input class="form-control m-1" type="text" name="titulo" id="titulo" value="{{ atividade.titulo }}" required>

        <label for="descricao">Descrição:</label>
        <textarea class="form-control m-1" name="descricao" id="descricao" rows="5" required>{{ atividade.descricao }}</textarea>

        <label for="data_atraso">Data para considerar atraso:</label>
        <input class="form-control m-1" type="datetime-local" name="data_atraso" id="data_atraso" 
               value="{{ atividade.data_atraso.strftime('%Y-%m-%dT%H:%M') }}" required>

        <label for="data_encerramento">Data limite de envio (encerramento):</label>
        <input class="form-control m-1" type="datetime-local" name="data_encerramento" id="data_encerramento" 
               value="{{ atividade.data_encerramento.strftime('%Y-%m-%dT%H:%M') }}" required>

        <label>Arquivo atual:</label>
        {% if atividade.arquivo %}
        {% set nome_original = atividade.arquivo.split('_' ~ turma_nome ~ '_')[0] %}
        <p>{{ nome_original }}</p>
        {% else %}
        <p>Nenhum arquivo enviado</p>
        {% endif %}

        <label for="arquivo">Substituir arquivo (opcional):</label>
        <input class="form-control m-1" type="file" name="arquivo" id="arquivo">

        <button type="button" id="btnSalvar" class="btn btn-primary m-1">Salvar alterações</button>
      </form>

      <a class="btn btn-secondary m-1" href="{{ url_for('auth.atividade_prof', turma_id=turma_id, disciplina_id=disciplina_id, nome_disciplina=nome_disciplina) }}">Voltar</a>
    </div>
  </div>
  <script>
document.addEventListener('DOMContentLoaded', function () {
    const btnSalvar = document.getElementById('btnSalvar');
    const form = document.querySelector('form');

    btnSalvar.addEventListener('click', function () {
        Swal.fire({
            title: 'Deseja realmente salvar as alterações?',
            text: "Esta ação atualizará a atividade.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sim, salvar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                form.submit();
            }
        });
    });
});
</script>
{% endblock %}
